<!doctype html>
<html>
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Payslip Viewer</title>

  <style>
    body {
      font-family: Arial, sans-serif;
      max-width: 900px;
      margin: 30px auto;
      padding: 0 15px;
    }
    h2 { margin-bottom: 10px; }
    label {
      font-weight: bold;
      display: block;
      margin-top: 15px;
    }
    input {
      width: 100%;
      padding: 10px;
      margin-top: 6px;
      box-sizing: border-box;
    }
    button {
      margin-top: 18px;
      padding: 10px 16px;
      font-size: 16px;
      cursor: pointer;
    }
    .msg {
      margin-top: 15px;
      font-weight: bold;
    }
    .error {
      color: #b00020;
    }
    .card {
      border: 1px solid #ddd;
      border-radius: 10px;
      padding: 15px;
      margin-top: 15px;
    }
    .row {
      display: flex;
      justify-content: space-between;
      padding: 6px 0;
      border-bottom: 1px dashed #eee;
    }
    .row:last-child {
      border-bottom: none;
    }
  </style>
</head>

<body>

<h2>Payslip Viewer</h2>
<div>Enter your Employee ID and Pay Date to generate your payslip.</div>

<label>Employee ID</label>
<input id="empId" placeholder="e.g. 2025001">

<label>Pay Date</label>
<input id="payDate" type="date">

<button onclick="generate()">Generate Payslip</button>

<div id="msg" class="msg"></div>
<div id="output"></div>

<script>
  // ðŸ”´ CHANGE ONLY THIS LINE
  const API_URL = "https://script.googleusercontent.com/a/macros/exodiagamedev.com/echo?user_content_key=AehSKLhHNHRWrYNsfJq_Zl18jj6jRp17k9VwDvjTQgwhju9-fXlYQbk-Crx2N64JhyZVpGuFEX9iXChxOZvZpLkBFz395K_6X-LaMSfZF4hRpiEQcy2-HGy6C9fLA6zAfCX62gGfinb2s_iSA8cIRe-R0YalocNQDJA91ix3XEb2eg-9xZixm_zcALoIv1IR1a9vWvkW6yMNK9hVs-LcqyLqpiput7OJh7lRC1IIccftitnbjdU13r-6BQUQVTTzIt5FDB04OI4-U7ewXrSM8whQKe_JVa3r-k_ZZYG9RqRjaSCz8UmVRcZ6ze0ZI0-v7mmgmRY1JixGRKbZ6_TYHJprwFkRT7PSE69pu6q3DuMZ&lib=M4kZOfvXs-BSfG1xN4vvDHe3i8jI5dE-p";

  function formatValue(v) {
    if (v === null || v === undefined) return "";
    const n = Number(v);
    if (!isNaN(n) && v !== "") return n.toLocaleString();
    return v;
  }

  function section(title, data) {
    let html = `<div class="card"><h3>${title}</h3>`;
    for (let k in data) {
      html += `<div class="row"><b>${k}</b><span>${formatValue(data[k])}</span></div>`;
    }
    html += `</div>`;
    return html;
  }

  async function generate() {
    const empId = document.getElementById("empId").value.trim();
    const payDate = document.getElementById("payDate").value;
    const msg = document.getElementById("msg");
    const output = document.getElementById("output");

    msg.textContent = "";
    output.innerHTML = "";

    if (!empId || !payDate) {
      msg.textContent = "Please enter Employee ID and Pay Date.";
      msg.className = "msg error";
      return;
    }

    const url = `${API_URL}?empId=${empId}&payDate=${payDate}`;

    try {
      msg.textContent = "Generating...";
      const res = await fetch(url);
      const data = await res.json();

      if (!data.ok) {
        msg.textContent = data.error;
        msg.className = "msg error";
        return;
      }

      msg.textContent = "";
      const r = data.result;

      output.innerHTML =
        section("Employee Information", r.Employee_Information) +
        section("Earnings (Per Payday)", r["Earnings_(Per_Payday)"]) +
        section("Deductions (Employee Share)", r["Deductions_(Employee_Share)"]) +
        section("NET PAY", r["NET_PAY"]) +
        section("Employer Contributions (Company Expense)", r["Employer_Contributions_(Company_Expense)"]);

    } catch (e) {
      msg.textContent = "Cannot connect to payroll system.";
      msg.className = "msg error";
    }
  }
</script>

</body>
</html>
